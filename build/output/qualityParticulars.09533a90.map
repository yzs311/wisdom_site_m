{"version":3,"sources":["js/qualityParticulars.js"],"names":["$","pid","localStorage","getItem","type","getQueryString","pollingId","pollingDetailId","describex","fileUrl","isAvailable","name","reg","RegExp","r","window","location","search","substr","match","unescape","on","event","stopPropagation","css","polling","html","setCentent","place","unitTitle","rank","createTime","deadlineTime","rectification","axios","post","then","res","number","console","log","data","i","msg","length","setState","addClass","click","change","e","headers","temp","target","files","file","FormData","append","attr","fileimgurl","val","alert"],"mappings":"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","file":"qualityParticulars.09533a90.map","sourceRoot":"..\\..","sourcesContent":["$(function (){\r\n    let pid = localStorage.getItem('pid')\r\n\r\n    // 提交整改所需数据\r\n    let type = getQueryString('type')                       // 表单状态\r\n    let pollingId = getQueryString('pollingId')             // 发起整改id\r\n    let pollingDetailId = getQueryString('pollingDetailId') // 整改流程id\r\n    let describex = ''                                      // 整改描述\r\n    let fileUrl = ''                                        // 照片路径\r\n    let isAvailable = ''                                    // 整改单状态\r\n\r\n    // console.log(`123`)\r\n    // 整改点击事件\r\n    $('.abarbeitung-button').on('click',function(event){\r\n        event.stopPropagation()\r\n        isAvailable = 1\r\n        $('.abarbeitung-box').css('display','block')\r\n    })\r\n\r\n    // 获取整改单id\r\n    function getQueryString(name) {\r\n        let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n        let r = window.location.search.substr(1).match(reg);\r\n        if (r != null) {\r\n            return unescape(r[2]);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // 获取整改单详情页\r\n    function getQueryPollingIs() {\r\n        // 获取url中的整改单id\r\n        // console.log(pollingId)\r\n        axios.post(`http://39.108.103.150:8989/lz/polling/queryPollingIs?pollingId=${pollingId}&type=${type}`).then(\r\n            res => {\r\n                let number = 1\r\n                console.log(res.data)\r\n                for (let i = 0; i < res.data.msg.length; i++) {\r\n                    if (res.data.msg[i].isAvailable == 2 || res.data.msg[i].isAvailable == 1) {                    \r\n                        html += \r\n                            `<div class=\"title\">\r\n                                第${number}次整改\r\n                            </div>\r\n                            <div class=\"describe\">\r\n                                <p>整改结果</p>\r\n                                <span>${res.data.msg[i].describex}</span>\r\n                            </div>\r\n                            <div class=\"name\">\r\n                                整改后照片\r\n                            </div>\r\n                            <div class=\"pic-box\" style=\"margin-bottom: .175rem\">\r\n                                <img src=\"${res.data.msg[i].fileUrl}\" alt=\"\">\r\n                            </div>`\r\n                            number++\r\n                    }\r\n                    if (res.data.msg[i].isAvailable == 6 || res.data.msg[i].isAvailable == 5) {\r\n                        html += \r\n                            `<div class=\"justify\">\r\n                                <span>复查人</span>\r\n                                <span class=\"white-color\">某某某</span>\r\n                            </div>\r\n                            <div class=\"justify\">\r\n                                <span>复查意见</span>\r\n                                <span class=\"white-color\">${res.data.msg[i].isAvailable == 6?'不通过':'通过'}</span>\r\n                            </div>\r\n                            <div class=\"name\">\r\n                                复查后照片\r\n                            </div>\r\n                            <div class=\"pic-box\" style=\"margin-bottom: .25rem\">\r\n                                <img src=\"${res.data.msg[i].fileUrl}\" alt=\"\">\r\n                            </div>\r\n                            <div class=\"line\"></div>`\r\n                    }\r\n                }\r\n                $('.centent-box').html(html)\r\n            }\r\n        )\r\n    }\r\n\r\n    // 获取复查单详情页\r\n\r\n    // 获取整改单详情页数据\r\n    let polling = ''\r\n    function getQueryPolling() {        \r\n        axios.post(`http://39.108.103.150:8989/lz/polling/queryPolling?examineUserId=${pid}&type=${type}`).then(\r\n            res => {\r\n                // console.log(res.data)\r\n                for (let i = 0; i < res.data.msg.length; i++) {\r\n                    if (res.data.msg[i].pollingId == pollingId) {\r\n                        console.log(res.data.msg[i])\r\n                        polling = res.data.msg[i]\r\n                        setCentent()\r\n                        setState()\r\n                    }\r\n                }\r\n            }\r\n        )\r\n    }\r\n\r\n    // 渲染整改单详情页\r\n    let html = ''\r\n    function setCentent() {\r\n        html = \r\n            `<div class=\"title\">\r\n                ${polling.describex}\r\n            </div>\r\n            <div class=\"justify\">\r\n                <span>检查区域</span>\r\n                <span class=\"white-color\">${polling.place}</span>\r\n            </div>\r\n            <div class=\"justify\">\r\n                <span>分包单位</span>\r\n                <span class=\"white-color\">${polling.unitTitle}</span>\r\n            </div>\r\n            <div class=\"border-bottom\"></div>\r\n            <div class=\"justify\">\r\n                <span>问题级别</span>\r\n                <span class=\"${polling.rank==1?'slight':polling.rank==2?'ordinary':'severity'}\">${polling.rank==1?'轻微':polling.rank==2?'一般':'严重'}</span>\r\n            </div>\r\n            <div class=\"pic-box\">\r\n                <img src=\"${polling.fileUrl}\" alt=\"\">\r\n            </div>\r\n            <div class=\"justify\">\r\n                <span>检查人</span>\r\n                <span class=\"white-color\">某某某</span>\r\n            </div>\r\n            <div class=\"justify\">\r\n                <span>检查时间</span>\r\n                <span class=\"white-color\">${polling.createTime}</span>\r\n            </div>\r\n            <div class=\"line\"></div>\r\n            <div class=\"title\">\r\n                整改通知\r\n            </div>\r\n            <div class=\"justify\">\r\n                <span>整改人</span>\r\n                <span class=\"white-color\">某某某</span>\r\n            </div>\r\n            <div class=\"justify\">\r\n                <span>整改时限</span>\r\n                <span class=\"white-color\">${polling.deadlineTime}</span>\r\n            </div>\r\n            <div class=\"describe\">\r\n                <p>整改要求</p>\r\n                <span>${polling.rectification}</span>\r\n            </div>\r\n            <div class=\"line\"></div>`\r\n        getQueryPollingIs()\r\n    }\r\n\r\n    getQueryPolling()\r\n\r\n    // 上传照片信息\r\n    // 添加照片点击事件\r\n    $('.addPic').on('click',function(){\r\n        $('.camera').click()\r\n    })\r\n\r\n    // 照片上传\r\n    $(\".camera\").change(function(e){\r\n        $('.addPic').css('display','none')\r\n        $('.uploading').css('display','block')\r\n        let headers = {headers: {\"Content-Type\": \"multipart/form-data\"}}\r\n        let temp = e.target.files[0]\r\n        file = new FormData() // 创建form对象\r\n        file.append('file',temp) // 通过append向form对象添加数据\r\n        // console.log(file.get('file')) //FormData私有类对象，访问不到，可以通过get判断值是否传进去\r\n        axios.post(`http://39.108.103.150:8989/lz/file/upload?folderName=1`,file,headers).then(\r\n            res => {\r\n                // console.log(res.data.data[0].fileimgurl)\r\n                $('.addPic').attr('src',res.data.data[0].fileimgurl)\r\n                $('.addPic').css('display','block')\r\n                $('.uploading').css('display','none')\r\n                fileUrl = res.data.data[0].fileimgurl\r\n            }\r\n        )\r\n    })\r\n\r\n    // 确认取消点击事件\r\n    $('.abarbeitung-affirm').on('click',function(event){\r\n        event.stopPropagation()\r\n        describex = $('.abarbeitung-box textarea').val()\r\n        axios.post(`http://39.108.103.150:8989/lz/polling/updatePollingDetail?id=${pollingDetailId}&pollingId=${pollingId}&examineUserid=${pid}&describex=${describex}&fileUrl=${fileUrl}&isAvailable=${isAvailable}`).then(\r\n            res => {\r\n                console.log(res.data)\r\n                if (res.data.msg == '整改成功！等待审核') {\r\n                    location = '../components/quality.html'\r\n                } else {\r\n                    alert(`数据上传失败！请重试`)\r\n                }\r\n            }\r\n        )\r\n    })\r\n    $('.abarbeitung-cancel').on('click',function(event){\r\n        event.stopPropagation()\r\n        console.log(`123`)\r\n        $('.abarbeitung-box').css('display','none')\r\n    })\r\n\r\n    // 根据整改单状态渲染按钮跟头部\r\n    function setState() {\r\n        if (type == 0) {\r\n            $('.state-box').html(\r\n                `<div class=\"state\">\r\n                    待整改\r\n                </div>\r\n                <div class=\"time\">\r\n                    创建时间： ${polling.createTime}\r\n                </div>`\r\n            ).addClass('orange-color')\r\n            $('.abarbeitung-button').css('display','block')\r\n            $('.review-button').css('display','none')\r\n        } else if (type == 1) {\r\n            $('.state-box').html(\r\n                `<div class=\"state\">\r\n                    待复查\r\n                </div>\r\n                <div class=\"time\">\r\n                    创建时间： ${polling.createTime}\r\n                </div>`\r\n            ).addClass('orange-color')\r\n        } else if (type == 2) {\r\n            $('.state-box').html(\r\n                `<div class=\"state\">\r\n                    已完成\r\n                </div>\r\n                <div class=\"time\">\r\n                    创建时间： ${polling.createTime}\r\n                </div>`\r\n            ).addClass('green-color')\r\n            $('.review-button').css('display','none')\r\n        }\r\n    }\r\n\r\n    // 通过或不通过点击事件\r\n    $('.review-button .pass').on('click',function(event){\r\n        event.stopPropagation()\r\n        isAvailable = 5\r\n        $('.review-box').css('display','block')\r\n    })\r\n    $('.review-button .no-pass').on('click',function(event){\r\n        event.stopPropagation()\r\n        isAvailable = 6\r\n        $('.review-box').css('display','block')\r\n    })\r\n\r\n    // 添加照片点击事件\r\n    $('.review-addPic').on('click',function(){\r\n        $('.review-camera').click()\r\n    })\r\n\r\n    // 照片上传\r\n    $(\".review-camera\").change(function(e){\r\n        $('.review-addPic').css('display','none')\r\n        $('.review-uploading').css('display','block')\r\n        let headers = {headers: {\"Content-Type\": \"multipart/form-data\"}}\r\n        let temp = e.target.files[0]\r\n        file = new FormData() // 创建form对象\r\n        file.append('file',temp) // 通过append向form对象添加数据\r\n        // console.log(file.get('file')) //FormData私有类对象，访问不到，可以通过get判断值是否传进去\r\n        axios.post(`http://39.108.103.150:8989/lz/file/upload?folderName=1`,file,headers).then(\r\n            res => {\r\n                // console.log(res.data.data[0].fileimgurl)\r\n                $('.review-addPic').attr('src',res.data.data[0].fileimgurl)\r\n                $('.review-addPic').css('display','block')\r\n                $('.review-uploading').css('display','none')\r\n                fileUrl = res.data.data[0].fileimgurl\r\n            }\r\n        )\r\n    })\r\n\r\n    // 确认取消点击事件\r\n    $('.review-affirm').on('click',function(event){\r\n        event.stopPropagation()\r\n        describex = $('.review-box textarea').val()\r\n        axios.post(`http://39.108.103.150:8989/lz/polling/updatePolling?id=${pollingDetailId}&pollingId=${pollingId}&examineUserid=${pid}&describex=${describex}&fileUrl=${fileUrl}&isAvailable=${isAvailable}`).then(\r\n            res => {\r\n                console.log(res.data)\r\n                if (res.data.msg == '审核成功！') {\r\n                    location = '../components/quality.html'\r\n                } else {\r\n                    alert(`数据上传失败！请重试`)\r\n                }\r\n            }\r\n        )\r\n    })\r\n    $('.review-cancel').on('click',function(event){\r\n        event.stopPropagation()\r\n        console.log(`123`)\r\n        $('.review-box').css('display','none')\r\n    })\r\n})"]}